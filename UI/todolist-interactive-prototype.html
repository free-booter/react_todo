<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TodoList 应用</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- FullCalendar依赖 -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <!-- 引入今日待办视图渲染器 -->
    <script src="today-view.js"></script>
    <style>
      /* 图表容器样式 */
      .chart-container {
        width: 100%;
        height: 300px;
        margin: 0;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .chart-container canvas {
        width: 100% !important;
        height: 100% !important;
        max-height: 300px;
      }

      #calendar {
        width: 100%;
        height: 600px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
    </style>
    <style>
      :root {
        --primary-color: #7c3aed; /* 紫色主题色 */
        --primary-light: #8b5cf6;
        --primary-dark: #6d28d9;
        --primary-bg: #f5f3ff;
        --white: #ffffff;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
      }

      body {
        background-color: var(--primary-bg);
        color: var(--gray-800);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }

      /* 顶部导航栏 */
      .top-nav {
        background: var(--white);
        height: 64px;
        padding: 0 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 40;
      }

      .search-bar {
        flex: 1;
        max-width: 600px;
        margin: 0 32px;
        position: relative;
      }

      .search-input {
        width: 100%;
        padding: 8px 16px 8px 40px;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        background-color: var(--gray-50);
        transition: all 0.2s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        background-color: var(--white);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-400);
      }

      /* 左侧边栏 */
      .sidebar {
        width: 240px;
        height: calc(100vh - 64px);
        position: fixed;
        left: 0;
        top: 64px;
        background: var(--white);
        border-right: 1px solid var(--gray-200);
        padding: 24px 16px;
        overflow-y: auto;
      }

      .nav-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        border-radius: 8px;
        color: var(--gray-700);
        transition: all 0.2s ease;
        cursor: pointer;
        margin-bottom: 4px;
      }

      .nav-item:hover {
        background-color: var(--primary-bg);
        color: var(--primary-color);
      }

      .nav-item.active {
        background-color: var(--primary-color);
        color: var(--white);
      }

      .nav-item i {
        margin-right: 12px;
        font-size: 18px;
      }

      /* 主内容区 */
      .main-content {
        margin-left: 240px;
        margin-top: 64px;
        padding: 32px;
        min-height: calc(100vh - 64px);
        overflow-y: auto;
      }

      /* Dashboard容器样式调整 */
      .dashboard-container {
        padding: 32px;
        margin-top: 64px;
        margin-left: 240px;
        min-height: calc(100vh - 64px);
        background-color: var(--primary-bg);
      }

      .board-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
        margin-top: 24px;
      }

      .board-column {
        background: var(--white);
        border-radius: 16px;
        padding: 20px;
        min-height: 200px;
      }

      .board-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
      }

      .board-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-700);
        display: flex;
        align-items: center;
      }

      .add-task-btn {
        width: 24px;
        height: 24px;
        border-radius: 6px;
        background: var(--primary-bg);
        color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .add-task-btn:hover {
        background: var(--primary-color);
        color: var(--white);
      }

      /* 任务卡片 */
      .task-card {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        transition: all 0.2s ease;
        cursor: pointer;
      }

      .task-card:hover {
        border-color: var(--primary-color);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transform: translateY(-2px);
      }

      .task-title {
        font-weight: 500;
        color: var(--gray-800);
        margin-bottom: 8px;
      }

      .task-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: var(--gray-500);
      }

      .task-tag {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
        background: var(--primary-bg);
        color: var(--primary-color);
      }

      /* 新建任务按钮 */
      .new-task-btn {
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: 48px;
        height: 48px;
        border-radius: 24px;
        background: var(--primary-color);
        color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 6px -1px rgba(124, 58, 237, 0.3);
      }

      .new-task-btn:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
      }

      /* 用户菜单 */
      .user-menu {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .user-menu .icon-btn {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gray-600);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .user-menu .icon-btn:hover {
        background: var(--gray-100);
        color: var(--gray-900);
      }

      /* 模态框样式优化 */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        display: none;
        z-index: 50;
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: var(--white);
        border-radius: 16px;
        padding: 24px;
        width: 90%;
        max-width: 480px;
        position: relative;
        animation: modalSlideIn 0.3s ease;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 24px;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-900);
      }

      .close-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gray-500);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .close-btn:hover {
        background: var(--gray-100);
        color: var(--gray-900);
      }

      /* 表单控件样式 */
      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        color: var(--gray-700);
        font-weight: 500;
      }

      .form-input {
        width: 100%;
        padding: 10px 16px;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
      }

      .form-select {
        width: 100%;
        padding: 10px 16px;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        background-color: var(--white);
        cursor: pointer;
      }

      .btn-group {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        margin-top: 24px;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-secondary {
        background: var(--gray-100);
        color: var(--gray-700);
      }

      .btn-secondary:hover {
        background: var(--gray-200);
      }

      .btn-primary {
        background: var(--primary-color);
        color: var(--white);
      }

      .btn-primary:hover {
        background: var(--primary-dark);
      }

      /* Dashboard 页面样式 */
      .dashboard-container {
        padding: 24px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
        margin-bottom: 32px;
      }

      .chart-container {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 24px;
        height: 400px; /* 固定高度 */
        position: relative; /* 为Canvas定位 */
      }

      .chart-container canvas {
        width: 100% !important;
        height: 100% !important;
      }

      /* 确保图表网格正确显示 */
      .chart-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        margin-top: 24px;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--gray-800);
      }

      .time-filter {
        display: flex;
        gap: 8px;
      }

      .time-filter button {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 14px;
        color: var(--gray-600);
        background: var(--gray-100);
        transition: all 0.2s;
      }

      .time-filter button.active {
        background: var(--primary-color);
        color: white;
      }

      .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .stat-title {
        color: var(--gray-600);
        font-size: 14px;
        margin-bottom: 8px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .stat-change {
        display: flex;
        align-items: center;
        font-size: 14px;
      }

      .stat-change.positive {
        color: #10b981;
      }

      .stat-change.negative {
        color: #ef4444;
      }

      .charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        margin-bottom: 32px;
      }

      .chart-card {
        background: var(--white);
        border-radius: 16px;
        padding: 24px;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--gray-800);
      }

      .time-filter {
        display: flex;
        gap: 8px;
      }

      .time-filter button {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 14px;
        color: var(--gray-600);
        background: var(--gray-50);
        transition: all 0.2s ease;
      }

      .time-filter button.active {
        background: var(--primary-color);
        color: var(--white);
      }

      .task-progress {
        display: flex;
        align-items: center;
        padding: 16px;
        border-radius: 12px;
        background: var(--gray-50);
        margin-bottom: 16px;
      }

      .progress-info {
        flex: 1;
      }

      .progress-title {
        font-weight: 500;
        margin-bottom: 8px;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: var(--gray-200);
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-value {
        height: 100%;
        background: var(--primary-color);
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .progress-percentage {
        margin-left: 16px;
        font-weight: 600;
        color: var(--primary-color);
      }

      .recent-activity {
        background: var(--white);
        border-radius: 16px;
        padding: 24px;
      }

      .activity-item {
        display: flex;
        align-items: flex-start;
        padding: 16px 0;
        border-bottom: 1px solid var(--gray-100);
      }

      .activity-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--primary-bg);
        color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 16px;
      }

      .activity-content {
        flex: 1;
      }

      /* 今日待办视图样式 */
      .today-stats {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
      }

      .today-stats .stat-item {
        flex: 1;
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        text-align: center;
        transition: all 0.3s ease;
      }

      .today-stats .stat-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .today-stats .stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 5px;
        color: #4a5568;
      }

      .today-stats .stat-label {
        color: #718096;
        font-size: 0.9rem;
      }

      .today-tasks {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .task-group {
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .task-group-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f7fafc;
        border-bottom: 1px solid #edf2f7;
      }

      .task-group-title {
        font-weight: 600;
        display: flex;
        align-items: center;
      }

      .task-count {
        background: #edf2f7;
        border-radius: 20px;
        padding: 2px 10px;
        font-size: 0.8rem;
        color: #4a5568;
      }

      .filter-count {
        background: #4299e1;
        color: white;
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: 10px;
      }

      /* 日历视图样式 */
      .calendar-container {
        padding: 24px;
        background: var(--white);
        border-radius: 16px;
        margin: 24px;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .calendar-title {
        font-size: 24px;
        font-weight: 600;
        color: var(--gray-800);
      }

      .calendar-actions {
        display: flex;
        gap: 12px;
      }

      .calendar-btn {
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
      }

      .calendar-btn i {
        margin-right: 8px;
      }

      .calendar-btn-secondary {
        background: var(--gray-100);
        color: var(--gray-700);
      }

      .calendar-btn-secondary:hover {
        background: var(--gray-200);
      }

      .calendar-btn-primary {
        background: var(--primary-color);
        color: var(--white);
      }

      .calendar-btn-primary:hover {
        background: var(--primary-dark);
      }

      .calendar-view-options {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
      }

      .calendar-view-btn {
        padding: 6px 16px;
        border-radius: 6px;
        font-size: 14px;
        color: var(--gray-600);
        background: var(--gray-50);
        transition: all 0.2s ease;
        cursor: pointer;
        border: none;
      }

      .calendar-view-btn:hover {
        background: var(--gray-100);
      }

      .calendar-view-btn.active {
        background: var(--primary-color);
        color: var(--white);
      }

      .calendar-main {
        background: var(--white);
        border-radius: 12px;
        padding: 20px;
        min-height: 600px;
      }

      /* FullCalendar 样式覆盖 */
      .fc {
        font-family: inherit;
      }

      .fc .fc-toolbar.fc-header-toolbar {
        margin-bottom: 1.5em;
      }

      .fc .fc-button-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .fc .fc-button-primary:hover {
        background-color: var(--primary-dark);
        border-color: var(--primary-dark);
      }

      .fc .fc-button-primary:not(:disabled).fc-button-active,
      .fc .fc-button-primary:not(:disabled):active {
        background-color: var(--primary-dark);
        border-color: var(--primary-dark);
      }

      .fc-daygrid-day-number,
      .fc-col-header-cell-cushion {
        color: var(--gray-700);
      }

      .fc-daygrid-event {
        border-radius: 4px;
        padding: 2px 4px;
      }

      .fc-event-time {
        font-size: 0.85em;
      }

      .fc-event-title {
        font-weight: 500;
      }

      .fc-list-event-dot {
        border-color: var(--primary-color);
      }

      .fc-list-day-cushion {
        background-color: var(--primary-bg) !important;
      }

      .activity-title {
        font-weight: 500;
      }

      /* 设置页面样式 */
      .settings-container {
        padding: 32px;
        margin-top: 64px;
        margin-left: 240px;
        min-height: calc(100vh - 64px);
        background-color: var(--primary-bg);
      }

      .settings-header {
        margin-bottom: 32px;
      }

      .settings-title {
        font-size: 24px;
        font-weight: 600;
        color: var(--gray-900);
      }

      .settings-content {
        max-width: 800px;
        margin: 0 auto;
      }

      .settings-section {
        background: var(--white);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 20px;
      }

      .settings-form {
        max-width: 600px;
      }

      .avatar-upload {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .avatar-preview {
        width: 80px;
        height: 80px;
        border-radius: 40px;
        overflow: hidden;
      }

      .avatar-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .theme-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .theme-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 16px;
        border-radius: 8px;
        border: 2px solid var(--gray-200);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .theme-option:hover {
        border-color: var(--primary-color);
      }

      .theme-option.active {
        border-color: var(--primary-color);
        background-color: var(--primary-bg);
      }

      .color-preview {
        width: 40px;
        height: 40px;
        border-radius: 20px;
      }

      .toggle-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
      }

      .toggle-switch {
        position: relative;
        width: 48px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--gray-300);
        transition: 0.4s;
        border-radius: 24px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: var(--white);
        transition: 0.4s;
        border-radius: 50%;
      }

      .toggle-switch input:checked + .toggle-slider {
        background-color: var(--primary-color);
      }

      .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }

      .notification-option,
      .privacy-option {
        margin-bottom: 20px;
      }

      .option-desc {
        margin-top: 4px;
        margin-left: 0;
        color: var(--gray-500);
        font-size: 14px;
      }

      .settings-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 32px;
      }

      /* 深色模式样式 */
      body.dark-mode {
        --primary-bg: #1f2937;
        --white: #111827;
        --gray-50: #374151;
        --gray-100: #4b5563;
        --gray-200: #6b7280;
        --gray-300: #9ca3af;
        --gray-400: #d1d5db;
        --gray-500: #e5e7eb;
        --gray-600: #f3f4f6;
        --gray-700: #f9fafb;
        --gray-800: #ffffff;
        --gray-900: #ffffff;
      }

      /* 番茄钟样式 */
      .pomodoro-container {
        background: var(--white);
        border-radius: 16px;
        padding: 24px;
        text-align: center;
      }

      .pomodoro-timer {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        border: 8px solid var(--primary-color);
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .pomodoro-time {
        font-size: 48px;
        font-weight: 600;
        color: var(--primary-color);
      }

      /* 专注模式样式 */
      .focus-mode {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          var(--primary-dark) 0%,
          var(--gray-900) 100%
        );
        color: var(--white);
        z-index: 100;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .focus-mode.active {
        display: flex;
      }

      /* 子任务样式 */
      .subtask-list {
        margin-top: 12px;
        padding-left: 24px;
      }

      .subtask-item {
        display: flex;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--gray-100);
      }

      .subtask-checkbox {
        width: 18px;
        height: 18px;
        border: 2px solid var(--primary-color);
        border-radius: 4px;
        margin-right: 8px;
        cursor: pointer;
      }

      /* 优先级矩阵样式 */
      .priority-matrix {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-top: 24px;
      }

      .matrix-quadrant {
        background: var(--white);
        border-radius: 12px;
        padding: 16px;
        border: 1px solid var(--gray-200);
      }

      .matrix-quadrant.urgent-important {
        border-color: var(--primary-color);
      }

      /* AI助手样式 */
      .ai-assistant {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--primary-dark) 100%
        );
        border-radius: 16px;
        padding: 20px;
        color: var(--white);
        margin-bottom: 24px;
      }

      .ai-suggestion {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        margin-top: 12px;
      }

      /* 数据分析样式 */
      .analytics-container {
        background: var(--white);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
      }

      .analytics-chart {
        height: 300px;
        margin-top: 20px;
      }

      /* 主题设置样式 */
      .theme-selector {
        display: flex;
        gap: 12px;
        margin-top: 16px;
      }

      .theme-option {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid transparent;
      }

      .theme-option.active {
        border-color: var(--primary-color);
      }

      /* 同步状态样式 */
      .sync-status {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: var(--primary-bg);
        border-radius: 8px;
        color: var(--primary-color);
        font-size: 14px;
      }

      .sync-status i {
        font-size: 16px;
      }

      /* 番茄钟样式 */
      .pomodoro-section {
        margin-top: auto;
        padding: 1rem;
        border-top: 1px solid var(--border-color);
      }

      .section-title {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.75rem;
        padding: 0 0.5rem;
      }

      .pomodoro-container {
        background: var(--bg-secondary);
        border-radius: 0.5rem;
        padding: 1rem;
      }

      .pomodoro-display {
        text-align: center;
      }

      .pomodoro-time {
        font-size: 2rem;
        font-weight: bold;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      .pomodoro-controls {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
      }

      .pomodoro-btn {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .pomodoro-btn.start {
        background: var(--primary-color);
        color: white;
      }

      .pomodoro-btn.start:hover {
        background: var(--primary-dark);
      }

      .pomodoro-btn.pause {
        background: var(--bg-primary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
      }

      .pomodoro-btn.pause:hover {
        background: var(--bg-hover);
      }

      /* 筛选区域样式 */
      .filter-section {
        padding: 1rem 0;
        border-top: 1px solid var(--border-color);
      }

      /* 保持原有的导航样式 */
      .nav-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s;
      }

      .nav-item:hover {
        background: var(--bg-hover);
      }

      .nav-item.active {
        background: var(--primary-light);
        color: var(--primary-color);
      }

      .nav-item i {
        margin-right: 0.75rem;
        width: 1.25rem;
        text-align: center;
      }

      /* 任务卡片样式 */
      .task-card {
        background: var(--bg-primary);
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid var(--border-color);
        position: relative;
        transition: all 0.2s;
      }

      .task-card:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* 完成状态复选框 */
      .task-checkbox {
        position: relative;
        display: inline-flex;
        align-items: center;
        cursor: pointer;
      }

      .task-checkbox input[type="checkbox"] {
        display: none;
      }

      .task-checkbox .checkbox-custom {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border-color);
        border-radius: 50%;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .task-checkbox input[type="checkbox"]:checked + .checkbox-custom {
        background: var(--primary-color);
        border-color: var(--primary-color);
      }

      .task-checkbox .checkbox-custom i {
        color: white;
        font-size: 0.75rem;
        opacity: 0;
        transform: scale(0);
        transition: all 0.2s;
      }

      .task-checkbox input[type="checkbox"]:checked + .checkbox-custom i {
        opacity: 1;
        transform: scale(1);
      }

      /* 已完成任务卡片样式 */
      .task-card.completed {
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: var(--bg-secondary);
        border: none;
        opacity: 0.8;
      }

      .task-card.completed:hover {
        opacity: 1;
        background: var(--bg-hover);
      }

      .task-card.completed .task-title {
        font-size: 0.875rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* 视图容器样式 */
      .content-wrapper > div {
        display: none;
      }

      .content-wrapper > div.active {
        display: block;
      }

      /* 统计卡片样式 */
      .stat-card {
        background: var(--white);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .stat-title {
        color: var(--gray-600);
        font-size: 14px;
        margin-bottom: 8px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      /* 日历视图按钮样式 */
      .calendar-btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.2s;
      }

      .calendar-btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .calendar-btn-primary:hover {
        background: var(--primary-dark);
      }

      .calendar-view-btn {
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 14px;
        color: var(--gray-600);
        background: var(--gray-100);
        transition: all 0.2s;
      }

      .calendar-view-btn.active {
        background: var(--primary-color);
        color: white;
      }

      /* 设置页面样式 */
      .theme-option {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .theme-option.active {
        transform: scale(1.1);
        box-shadow: 0 0 0 2px white, 0 0 0 4px currentColor;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--gray-300);
        transition: 0.4s;
        border-radius: 24px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .toggle-slider {
        background-color: var(--primary-color);
      }

      input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }

      /* 图表区域样式 */
      .charts-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-top: 24px;
      }

      .chart-section-full {
        width: 100%;
        margin-top: 24px;
      }

      .chart-box {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .w-full {
        width: 100%;
      }

      .mt-6 {
        margin-top: 1.5rem;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .chart-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-800);
      }

      .chart-filters {
        display: flex;
        gap: 8px;
      }

      .chart-filter-btn {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 14px;
        color: var(--gray-600);
        background: var(--gray-100);
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }

      .chart-filter-btn.active {
        background: var(--primary-color);
        color: white;
      }

      .chart-container {
        height: 300px;
        position: relative;
        margin-top: 20px;
      }

      .chart-container canvas {
        width: 100% !important;
        height: 100% !important;
        max-height: 300px;
      }

      /* 数据统计视图样式 */
      .dashboard-view {
        padding: 24px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
        margin-bottom: 24px;
      }

      .stat-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .stat-title {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 8px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 12px;
      }

      .stat-desc {
        font-size: 14px;
        color: var(--gray-500);
      }

      /* 首页焦点区域样式 */
      .home-focus-section {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-top: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--gray-800);
      }

      .section-action-btn {
        padding: 6px 12px;
        background-color: var(--primary-bg);
        color: var(--primary-color);
        border-radius: 6px;
        font-size: 14px;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }

      .section-action-btn:hover {
        background-color: var(--primary-color);
        color: white;
      }

      .focus-tasks {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .focus-task-card {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        background-color: var(--gray-50);
        border-radius: 8px;
        transition: all 0.2s;
      }

      .focus-task-card:hover {
        background-color: var(--gray-100);
      }

      .task-priority {
        width: 4px;
        height: 36px;
        border-radius: 2px;
        margin-right: 16px;
      }

      .task-priority.high {
        background-color: #ef4444;
      }

      .task-priority.medium {
        background-color: #f59e0b;
      }

      .task-priority.low {
        background-color: #10b981;
      }

      .task-content {
        flex: 1;
      }

      .task-content h4 {
        font-size: 15px;
        font-weight: 500;
        color: var(--gray-800);
        margin-bottom: 4px;
      }

      .task-meta {
        font-size: 13px;
        color: var(--gray-500);
      }

      .task-actions {
        display: flex;
        gap: 8px;
      }

      .task-action-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: white;
        border: 1px solid var(--gray-200);
        color: var(--gray-400);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .task-action-btn:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      /* 进度条样式 */
      .progress-bar {
        width: 100%;
        height: 6px;
        background-color: var(--gray-200);
        border-radius: 3px;
        margin-bottom: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background-color: var(--primary-color);
        border-radius: 3px;
      }

      .text-xs {
        font-size: 12px;
      }

      .mt-1 {
        margin-top: 4px;
      }

      /* 完成率趋势样式 */
      .completion-stats {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 16px;
      }

      .completion-stat-row {
        display: flex;
        align-items: center;
      }

      .completion-day {
        width: 50px;
        font-size: 14px;
        color: var(--gray-600);
        margin-right: 12px;
      }

      .completion-bar-container {
        flex: 1;
        height: 24px;
        background-color: var(--gray-100);
        border-radius: 4px;
        position: relative;
        display: flex;
        align-items: center;
      }

      .completion-bar {
        height: 100%;
        background-color: var(--primary-color);
        border-radius: 4px;
      }

      .completion-percent {
        position: absolute;
        right: 12px;
        font-size: 13px;
        font-weight: 500;
        color: var(--gray-800);
      }
    </style>
  </head>
  <body>
    <!-- 顶部导航栏 -->
    <nav class="top-nav">
      <div class="flex items-center">
        <h1 class="text-xl font-bold text-gray-800">TodoList</h1>
        <div class="search-bar">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            class="search-input"
            placeholder="请输入任务名称"
          />
        </div>
      </div>
      <div class="user-menu">
        <button class="icon-btn">
          <i class="far fa-bell"></i>
        </button>
        <button class="icon-btn">
          <i class="fas fa-cog"></i>
        </button>
        <div class="flex items-center gap-2">
          <img
            src="https://via.placeholder.com/32"
            class="rounded-full"
            alt="用户头像"
          />
          <span class="text-sm font-medium">张三</span>
        </div>
      </div>
    </nav>

    <!-- 左侧边栏 -->
    <aside class="sidebar">
      <!-- 导航菜单 -->
      <div class="nav-item active" data-view="home">
        <i class="fas fa-home"></i>
        <span>首页</span>
      </div>
      <div class="nav-item" data-view="dashboard">
        <i class="fas fa-chart-bar"></i>
        <span>数据统计</span>
      </div>
      <div class="nav-item" data-view="calendar">
        <i class="fas fa-calendar"></i>
        <span>日历视图</span>
      </div>
      <div class="nav-item" data-view="settings">
        <i class="fas fa-cog"></i>
        <span>设置</span>
      </div>

      <!-- 任务筛选 -->
      <div class="filter-section mt-8">
        <div class="section-title">任务筛选</div>
        <div class="nav-item">
          <i class="fas fa-flag text-red-500"></i>
          <span>高优先级</span>
        </div>
        <div class="nav-item filter-item" data-filter="today" data-view="today">
          <i class="fas fa-clock text-yellow-500"></i>
          <span>今日待办</span>
          <span class="filter-count">7</span>
        </div>
        <div class="nav-item">
          <i class="fas fa-star text-yellow-400"></i>
          <span>已收藏</span>
        </div>
      </div>

      <!-- 番茄钟模块 -->
      <div class="pomodoro-section">
        <div class="section-title">番茄工作法</div>
        <div class="pomodoro-container">
          <div class="pomodoro-display">
            <div class="pomodoro-time" id="pomodoroTimer">25:00</div>
            <div class="pomodoro-controls">
              <button class="pomodoro-btn start" id="startPomodoro">
                <i class="fas fa-play"></i>
              </button>
              <button class="pomodoro-btn pause" id="pausePomodoro">
                <i class="fas fa-pause"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- 主要内容区域 -->
    <div class="content-wrapper">
      <!-- 今日待办视图 -->
      <div class="view today-todo-view" style="display: none">
        <main class="main-content">
          <div class="section-header mb-6">
            <h2 class="text-2xl font-bold">今日待办</h2>
            <div class="flex items-center">
              <select
                class="sort-select mr-4 py-2 px-4 bg-white border border-gray-200 rounded-md text-gray-700"
              >
                <option value="priority">按优先级</option>
                <option value="deadline">按截止时间</option>
                <option value="created">按创建时间</option>
              </select>
              <button class="btn btn-primary" id="addTodayTaskBtn">
                <i class="fas fa-plus mr-2"></i>添加任务
              </button>
            </div>
          </div>

          <!-- 今日待办统计 -->
          <div class="grid grid-cols-4 gap-6 mb-8">
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">总任务</div>
              <div class="stat-value text-primary-color">7</div>
            </div>
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">已完成</div>
              <div class="stat-value text-green-500">3</div>
            </div>
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">剩余</div>
              <div class="stat-value text-yellow-500">4</div>
            </div>
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">完成率</div>
              <div class="stat-value text-primary-color">42.8%</div>
            </div>
          </div>

          <!-- 今日任务列表 -->
          <div class="space-y-6">
            <!-- 高优先级任务 -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
              <div
                class="bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center"
              >
                <h3 class="font-semibold flex items-center">
                  <i class="fas fa-circle text-red-500 mr-2"></i>高优先级
                </h3>
                <span class="px-3 py-1 bg-gray-200 rounded-full text-sm"
                  >2</span
                >
              </div>
              <div class="p-0">
                <!-- 任务1 -->
                <div
                  class="border-b border-gray-100 p-5 hover:bg-gray-50 transition-colors"
                >
                  <div class="flex items-start">
                    <div class="mr-4 mt-1">
                      <input
                        type="checkbox"
                        id="today-high-task1"
                        class="rounded-full w-5 h-5 border-2 border-gray-300 checked:bg-primary-color cursor-pointer"
                      />
                    </div>
                    <div class="flex-1">
                      <h4 class="font-medium text-gray-800 mb-1">首页重构</h4>
                      <div class="flex text-sm text-gray-600 mb-2">
                        <span class="mr-3"
                          ><i class="far fa-clock mr-1"></i>剩余2天</span
                        >
                        <span>完成度75%</span>
                      </div>
                      <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div
                          class="h-full bg-primary-color"
                          style="width: 75%"
                        ></div>
                      </div>
                    </div>
                    <div class="ml-4">
                      <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- 任务2 -->
                <div class="p-5 hover:bg-gray-50 transition-colors">
                  <div class="flex items-start">
                    <div class="mr-4 mt-1">
                      <input
                        type="checkbox"
                        id="today-high-task2"
                        class="rounded-full w-5 h-5 border-2 border-gray-300 checked:bg-primary-color cursor-pointer"
                      />
                    </div>
                    <div class="flex-1">
                      <h4 class="font-medium text-gray-800 mb-1">API开发</h4>
                      <div class="flex text-sm text-gray-600 mb-2">
                        <span class="mr-3"
                          ><i class="far fa-clock mr-1"></i>剩余3天</span
                        >
                        <span>完成度60%</span>
                      </div>
                      <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div
                          class="h-full bg-primary-color"
                          style="width: 60%"
                        ></div>
                      </div>
                    </div>
                    <div class="ml-4">
                      <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 中优先级任务 -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
              <div
                class="bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center"
              >
                <h3 class="font-semibold flex items-center">
                  <i class="fas fa-circle text-yellow-500 mr-2"></i>中优先级
                </h3>
                <span class="px-3 py-1 bg-gray-200 rounded-full text-sm"
                  >2</span
                >
              </div>
              <div class="p-0">
                <!-- 任务1 -->
                <div
                  class="border-b border-gray-100 p-5 hover:bg-gray-50 transition-colors"
                >
                  <div class="flex items-start">
                    <div class="mr-4 mt-1">
                      <input
                        type="checkbox"
                        id="today-medium-task1"
                        class="rounded-full w-5 h-5 border-2 border-gray-300 checked:bg-primary-color cursor-pointer"
                      />
                    </div>
                    <div class="flex-1">
                      <h4 class="font-medium text-gray-800 mb-1">团队周会</h4>
                      <div class="flex text-sm text-gray-600">
                        <span><i class="far fa-clock mr-1"></i>今天 10:00</span>
                      </div>
                    </div>
                    <div class="ml-4">
                      <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- 任务2 -->
                <div class="p-5 hover:bg-gray-50 transition-colors">
                  <div class="flex items-start">
                    <div class="mr-4 mt-1">
                      <input
                        type="checkbox"
                        id="today-medium-task2"
                        class="rounded-full w-5 h-5 border-2 border-gray-300 checked:bg-primary-color cursor-pointer"
                      />
                    </div>
                    <div class="flex-1">
                      <h4 class="font-medium text-gray-800 mb-1">数据分析</h4>
                      <div class="flex text-sm text-gray-600 mb-2">
                        <span class="mr-3"
                          ><i class="far fa-clock mr-1"></i>今天 16:00</span
                        >
                        <span>完成度40%</span>
                      </div>
                      <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div
                          class="h-full bg-primary-color"
                          style="width: 40%"
                        ></div>
                      </div>
                    </div>
                    <div class="ml-4">
                      <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 已完成任务 -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
              <div
                class="bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center"
              >
                <h3 class="font-semibold flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>已完成
                </h3>
                <span class="px-3 py-1 bg-gray-200 rounded-full text-sm"
                  >3</span
                >
              </div>
              <div class="p-0">
                <!-- 任务1 -->
                <div
                  class="border-b border-gray-100 p-5 hover:bg-gray-50 transition-colors"
                >
                  <div class="flex items-start">
                    <div class="mr-4 mt-1">
                      <input
                        type="checkbox"
                        id="today-done-task1"
                        class="rounded-full w-5 h-5 border-2 border-gray-300 checked:bg-primary-color cursor-pointer"
                        checked
                      />
                    </div>
                    <div class="flex-1">
                      <h4 class="font-medium text-gray-500 line-through mb-1">
                        登录功能优化
                      </h4>
                      <div class="flex text-sm text-gray-400">
                        <span
                          ><i class="far fa-check-circle mr-1"></i>今天
                          09:30</span
                        >
                      </div>
                    </div>
                    <div class="ml-4">
                      <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- 任务2 -->
                <div
                  class="border-b border-gray-100 p-5 hover:bg-gray-50 transition-colors"
                >
                  <div class="flex items-start">
                    <div class="mr-4 mt-1">
                      <input
                        type="checkbox"
                        id="today-done-task2"
                        class="rounded-full w-5 h-5 border-2 border-gray-300 checked:bg-primary-color cursor-pointer"
                        checked
                      />
                    </div>
                    <div class="flex-1">
                      <h4 class="font-medium text-gray-500 line-through mb-1">
                        Bug修复
                      </h4>
                      <div class="flex text-sm text-gray-400">
                        <span
                          ><i class="far fa-check-circle mr-1"></i>今天
                          11:20</span
                        >
                      </div>
                    </div>
                    <div class="ml-4">
                      <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- 任务3 -->
                <div class="p-5 hover:bg-gray-50 transition-colors">
                  <div class="flex items-start">
                    <div class="mr-4 mt-1">
                      <input
                        type="checkbox"
                        id="today-done-task3"
                        class="rounded-full w-5 h-5 border-2 border-gray-300 checked:bg-primary-color cursor-pointer"
                        checked
                      />
                    </div>
                    <div class="flex-1">
                      <h4 class="font-medium text-gray-500 line-through mb-1">
                        文档更新
                      </h4>
                      <div class="flex text-sm text-gray-400">
                        <span
                          ><i class="far fa-check-circle mr-1"></i>今天
                          13:45</span
                        >
                      </div>
                    </div>
                    <div class="ml-4">
                      <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- 首页看板视图 -->
      <div class="view home-view" style="display: block">
        <main class="main-content">
          <!-- 现有的首页内容 -->
          <!-- 顶部统计 -->
          <div class="grid grid-cols-4 gap-6 mb-8">
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">今日任务</div>
              <div class="stat-value text-primary-color">7</div>
              <div class="text-sm text-gray-500 mt-2">
                <i class="fas fa-tasks text-blue-500"></i>
                <span class="ml-1">已完成 3/7</span>
              </div>
            </div>
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">待处理优先项</div>
              <div class="stat-value text-yellow-500">4</div>
              <div class="text-sm text-gray-500 mt-2">
                <i class="fas fa-exclamation-circle text-red-500"></i>
                <span class="ml-1">2个高优先级</span>
              </div>
            </div>
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">今日已完成</div>
              <div class="stat-value text-green-500">3</div>
              <div class="text-sm text-gray-500 mt-2">
                <i class="fas fa-check-circle text-green-500"></i>
                <span class="ml-1">完成率 42.8%</span>
              </div>
            </div>
            <div class="stat-card hover:shadow-lg transition-all">
              <div class="stat-title">本周目标</div>
              <div class="stat-value text-primary-color">
                15<span class="text-sm text-gray-500">/20</span>
              </div>
              <div class="text-sm text-gray-500 mt-2">
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 75%"></div>
                </div>
                <span class="text-xs mt-1">已完成 75%</span>
              </div>
            </div>
          </div>

          <!-- 今日焦点任务 -->
          <div class="home-focus-section mb-8">
            <div class="section-header">
              <h3 class="section-title">今日优先事项</h3>
              <button class="section-action-btn">
                <i class="fas fa-plus mr-1"></i>添加
              </button>
            </div>
            <div class="focus-tasks">
              <div class="focus-task-card">
                <div class="task-priority high"></div>
                <div class="task-content">
                  <h4>首页重构</h4>
                  <div class="task-meta">
                    <span
                      ><i class="far fa-clock mr-1"></i>剩余2天 ·
                      完成度75%</span
                    >
                  </div>
                </div>
                <div class="task-actions">
                  <button class="task-action-btn">
                    <i class="far fa-check-circle"></i>
                  </button>
                </div>
              </div>
              <div class="focus-task-card">
                <div class="task-priority high"></div>
                <div class="task-content">
                  <h4>API开发</h4>
                  <div class="task-meta">
                    <span
                      ><i class="far fa-clock mr-1"></i>剩余3天 ·
                      完成度60%</span
                    >
                  </div>
                </div>
                <div class="task-actions">
                  <button class="task-action-btn">
                    <i class="far fa-check-circle"></i>
                  </button>
                </div>
              </div>
              <div class="focus-task-card">
                <div class="task-priority medium"></div>
                <div class="task-content">
                  <h4>团队周会</h4>
                  <div class="task-meta">
                    <span><i class="far fa-clock mr-1"></i>明天 10:00</span>
                  </div>
                </div>
                <div class="task-actions">
                  <button class="task-action-btn">
                    <i class="far fa-check-circle"></i>
                  </button>
                </div>
              </div>
              <div class="focus-task-card">
                <div class="task-priority medium"></div>
                <div class="task-content">
                  <h4>数据分析</h4>
                  <div class="task-meta">
                    <span
                      ><i class="far fa-clock mr-1"></i>剩余4天 ·
                      完成度40%</span
                    >
                  </div>
                </div>
                <div class="task-actions">
                  <button class="task-action-btn">
                    <i class="far fa-check-circle"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 任务看板 -->
          <div class="board-container">
            <!-- 待处理任务 -->
            <div class="board-column">
              <div class="board-header">
                <h3 class="board-title">
                  <i class="fas fa-clipboard-list text-yellow-500 mr-2"></i>
                  待处理
                  <span class="ml-2 text-sm text-gray-500">(8)</span>
                </h3>
                <button class="add-task-btn">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              <div class="task-list">
                <!-- 任务1：带子任务 -->
                <div class="task-card" data-task-id="1">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">产品需求分析</h4>
                    <span class="task-tag bg-red-100 text-red-800"
                      >高优先级</span
                    >
                  </div>
                  <div class="task-progress mb-2">
                    <div
                      class="flex justify-between text-sm text-gray-500 mb-1"
                    >
                      <span>子任务进度</span>
                      <span>2/4</span>
                    </div>
                    <div class="h-1 bg-gray-200 rounded-full">
                      <div
                        class="h-1 bg-primary-color rounded-full"
                        style="width: 50%"
                      ></div>
                    </div>
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>今天 14:00
                    </span>
                  </div>
                  <!-- 子任务预览 -->
                  <div
                    class="subtasks-preview mt-2 pt-2 border-t border-gray-100"
                  >
                    <div
                      class="subtask-item flex items-center text-sm text-gray-500"
                    >
                      <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      <span>收集用户反馈</span>
                    </div>
                    <div
                      class="subtask-item flex items-center text-sm text-gray-500"
                    >
                      <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      <span>竞品分析</span>
                    </div>
                    <div
                      class="text-xs text-primary-color mt-1 cursor-pointer hover:underline"
                    >
                      显示全部子任务...
                    </div>
                  </div>
                </div>

                <!-- 任务2：普通任务 -->
                <div class="task-card" data-task-id="2">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">团队周会</h4>
                    <span class="task-tag bg-yellow-100 text-yellow-800"
                      >中优先级</span
                    >
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>明天 10:00
                    </span>
                  </div>
                </div>

                <!-- 任务3：带附件 -->
                <div class="task-card" data-task-id="3">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">设计评审</h4>
                    <span class="task-tag bg-blue-100 text-blue-800"
                      >低优先级</span
                    >
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>周五 15:00
                    </span>
                  </div>
                  <div
                    class="task-attachments mt-2 pt-2 border-t border-gray-100"
                  >
                    <div class="flex items-center text-sm text-gray-500">
                      <i class="fas fa-paperclip mr-2"></i>
                      <span>设计稿.fig</span>
                    </div>
                  </div>
                </div>

                <!-- 任务4：普通任务 -->
                <div class="task-card" data-task-id="4">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">用户调研报告</h4>
                    <span class="task-tag bg-red-100 text-red-800"
                      >高优先级</span
                    >
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>周四 16:00
                    </span>
                  </div>
                </div>

                <!-- 任务5：带子任务 -->
                <div class="task-card" data-task-id="5">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">性能优化</h4>
                    <span class="task-tag bg-yellow-100 text-yellow-800"
                      >中优先级</span
                    >
                  </div>
                  <div class="task-progress mb-2">
                    <div
                      class="flex justify-between text-sm text-gray-500 mb-1"
                    >
                      <span>子任务进度</span>
                      <span>1/3</span>
                    </div>
                    <div class="h-1 bg-gray-200 rounded-full">
                      <div
                        class="h-1 bg-primary-color rounded-full"
                        style="width: 33%"
                      ></div>
                    </div>
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>下周一
                    </span>
                  </div>
                </div>

                <!-- 查看更多按钮 -->
                <button
                  class="view-more-btn w-full mt-4 py-2 text-sm text-primary-color hover:bg-primary-bg rounded-lg transition-all"
                >
                  查看更多 (3) <i class="fas fa-chevron-down ml-1"></i>
                </button>
              </div>
            </div>

            <!-- 进行中任务 -->
            <div class="board-column">
              <div class="board-header">
                <h3 class="board-title">
                  <i class="fas fa-spinner text-blue-500 mr-2"></i>
                  进行中
                  <span class="ml-2 text-sm text-gray-500">(5)</span>
                </h3>
              </div>
              <div class="task-list">
                <!-- 任务1：进行中带进度 -->
                <div class="task-card" data-task-id="6">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">首页重构</h4>
                    <span class="task-tag bg-red-100 text-red-800"
                      >高优先级</span
                    >
                  </div>
                  <div class="task-progress mb-2">
                    <div
                      class="flex justify-between text-sm text-gray-500 mb-1"
                    >
                      <span>完成进度</span>
                      <span>75%</span>
                    </div>
                    <div class="h-1 bg-gray-200 rounded-full">
                      <div
                        class="h-1 bg-primary-color rounded-full"
                        style="width: 75%"
                      ></div>
                    </div>
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>剩余 2 天
                    </span>
                  </div>
                </div>

                <!-- 任务2：协作任务 -->
                <div class="task-card" data-task-id="7">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">API 开发</h4>
                    <span class="task-tag bg-yellow-100 text-yellow-800"
                      >中优先级</span
                    >
                  </div>
                  <div class="task-progress mb-2">
                    <div
                      class="flex justify-between text-sm text-gray-500 mb-1"
                    >
                      <span>完成进度</span>
                      <span>60%</span>
                    </div>
                    <div class="h-1 bg-gray-200 rounded-full">
                      <div
                        class="h-1 bg-primary-color rounded-full"
                        style="width: 60%"
                      ></div>
                    </div>
                  </div>
                  <div class="task-meta flex justify-between">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>剩余 3 天
                    </span>
                    <div class="flex -space-x-2">
                      <div
                        class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs"
                      >
                        ZL
                      </div>
                      <div
                        class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white text-xs"
                      >
                        WX
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 任务3：带附件 -->
                <div class="task-card" data-task-id="8">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4 class="task-title font-medium">数据分析</h4>
                    <span class="task-tag bg-yellow-100 text-yellow-800"
                      >中优先级</span
                    >
                  </div>
                  <div class="task-progress mb-2">
                    <div
                      class="flex justify-between text-sm text-gray-500 mb-1"
                    >
                      <span>完成进度</span>
                      <span>40%</span>
                    </div>
                    <div class="h-1 bg-gray-200 rounded-full">
                      <div
                        class="h-1 bg-primary-color rounded-full"
                        style="width: 40%"
                      ></div>
                    </div>
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="far fa-clock mr-1"></i>剩余 4 天
                    </span>
                  </div>
                </div>

                <!-- 查看更多按钮 -->
                <button
                  class="view-more-btn w-full mt-4 py-2 text-sm text-primary-color hover:bg-primary-bg rounded-lg transition-all"
                >
                  查看更多 (2) <i class="fas fa-chevron-down ml-1"></i>
                </button>
              </div>
            </div>

            <!-- 已完成任务 -->
            <div class="board-column">
              <div class="board-header">
                <h3 class="board-title">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  已完成
                  <span class="ml-2 text-sm text-gray-500">(11)</span>
                </h3>
              </div>
              <div class="task-list">
                <!-- 已完成任务1 -->
                <div class="task-card completed" data-task-id="9">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4
                      class="task-title font-medium line-through text-gray-500"
                    >
                      登录功能优化
                    </h4>
                    <span class="task-tag bg-green-100 text-green-800"
                      >已完成</span
                    >
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="fas fa-check text-green-500 mr-1"></i>今天 09:30
                    </span>
                  </div>
                </div>

                <!-- 已完成任务2 -->
                <div class="task-card completed" data-task-id="10">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4
                      class="task-title font-medium line-through text-gray-500"
                    >
                      Bug修复
                    </h4>
                    <span class="task-tag bg-green-100 text-green-800"
                      >已完成</span
                    >
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="fas fa-check text-green-500 mr-1"></i>昨天 15:20
                    </span>
                  </div>
                </div>

                <!-- 已完成任务3 -->
                <div class="task-card completed" data-task-id="11">
                  <div
                    class="task-header flex items-center justify-between mb-2"
                  >
                    <h4
                      class="task-title font-medium line-through text-gray-500"
                    >
                      文档更新
                    </h4>
                    <span class="task-tag bg-green-100 text-green-800"
                      >已完成</span
                    >
                  </div>
                  <div class="task-meta">
                    <span class="text-gray-500">
                      <i class="fas fa-check text-green-500 mr-1"></i>昨天 11:30
                    </span>
                  </div>
                </div>

                <!-- 查看更多按钮 -->
                <button
                  class="view-more-btn w-full mt-4 py-2 text-sm text-primary-color hover:bg-primary-bg rounded-lg transition-all"
                >
                  查看更多 (8) <i class="fas fa-chevron-down ml-1"></i>
                </button>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- 数据统计视图 -->
      <div class="view dashboard-view" style="display: none">
        <div class="dashboard-container">
          <!-- 统计卡片 - 数据统计版 -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-title">总任务数</div>
              <div class="stat-value">24</div>
              <div class="stat-desc">
                <i class="fas fa-arrow-up text-green-500 mr-1"></i>
                <span>较上月增长 12%</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-title">已完成</div>
              <div class="stat-value">11</div>
              <div class="stat-desc">
                <span>总完成率 45.8%</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-title">进行中</div>
              <div class="stat-value">5</div>
              <div class="stat-desc">
                <span>2个高优先级任务</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-title">待处理</div>
              <div class="stat-value">8</div>
              <div class="stat-desc">
                <span>3个即将到期</span>
              </div>
            </div>
          </div>

          <!-- 任务完成率统计 -->
          <div class="home-focus-section">
            <div class="section-header">
              <h3 class="section-title">完成率趋势</h3>
              <div class="chart-filters">
                <button class="chart-filter-btn active" data-period="week">
                  周
                </button>
                <button class="chart-filter-btn" data-period="month">月</button>
                <button class="chart-filter-btn" data-period="year">年</button>
              </div>
            </div>
            <div class="completion-stats">
              <div class="completion-stat-row">
                <div class="completion-day">周一</div>
                <div class="completion-bar-container">
                  <div class="completion-bar" style="width: 60%"></div>
                  <span class="completion-percent">60%</span>
                </div>
              </div>
              <div class="completion-stat-row">
                <div class="completion-day">周二</div>
                <div class="completion-bar-container">
                  <div class="completion-bar" style="width: 80%"></div>
                  <span class="completion-percent">80%</span>
                </div>
              </div>
              <div class="completion-stat-row">
                <div class="completion-day">周三</div>
                <div class="completion-bar-container">
                  <div class="completion-bar" style="width: 45%"></div>
                  <span class="completion-percent">45%</span>
                </div>
              </div>
              <div class="completion-stat-row">
                <div class="completion-day">周四</div>
                <div class="completion-bar-container">
                  <div class="completion-bar" style="width: 70%"></div>
                  <span class="completion-percent">70%</span>
                </div>
              </div>
              <div class="completion-stat-row">
                <div class="completion-day">周五</div>
                <div class="completion-bar-container">
                  <div class="completion-bar" style="width: 90%"></div>
                  <span class="completion-percent">90%</span>
                </div>
              </div>
              <div class="completion-stat-row">
                <div class="completion-day">周六</div>
                <div class="completion-bar-container">
                  <div class="completion-bar" style="width: 30%"></div>
                  <span class="completion-percent">30%</span>
                </div>
              </div>
              <div class="completion-stat-row">
                <div class="completion-day">周日</div>
                <div class="completion-bar-container">
                  <div class="completion-bar" style="width: 20%"></div>
                  <span class="completion-percent">20%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 图表区域 -->
          <div class="charts-section">
            <div class="chart-box">
              <div class="chart-header">
                <h3 class="chart-title">任务趋势</h3>
                <div class="chart-filters">
                  <button class="chart-filter-btn active" data-period="week">
                    周
                  </button>
                  <button class="chart-filter-btn" data-period="month">
                    月
                  </button>
                  <button class="chart-filter-btn" data-period="year">
                    年
                  </button>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="trendsChart"></canvas>
              </div>
            </div>

            <div class="chart-box">
              <div class="chart-header">
                <h3 class="chart-title">任务分布</h3>
              </div>
              <div class="chart-container">
                <canvas id="distributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- 标签统计区域 -->
        <div class="chart-section-full mt-6">
          <div class="chart-box w-full">
            <div class="chart-header">
              <h3 class="chart-title">标签统计</h3>
              <div class="chart-filters">
                <button class="chart-filter-btn active" data-period="all">
                  全部
                </button>
                <button class="chart-filter-btn" data-period="week">
                  本周
                </button>
                <button class="chart-filter-btn" data-period="month">
                  本月
                </button>
              </div>
            </div>
            <div class="chart-container" style="height: 350px">
              <canvas id="tagsChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- 日历视图 -->
      <div class="view calendar-view" style="display: none">
        <div class="bg-white rounded-lg p-6 shadow-sm">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">日历视图</h2>
            <div class="flex gap-2">
              <button
                class="calendar-btn calendar-btn-primary"
                id="addEventBtn"
              >
                <i class="fas fa-plus mr-2"></i>添加事件
              </button>
            </div>
          </div>
          <div class="flex gap-2 mb-4">
            <button class="calendar-view-btn active" data-view="dayGridMonth">
              月
            </button>
            <button class="calendar-view-btn" data-view="timeGridWeek">
              周
            </button>
            <button class="calendar-view-btn" data-view="listWeek">列表</button>
          </div>
          <div id="calendar" class="w-full h-[600px] bg-white"></div>
        </div>
      </div>

      <!-- 设置视图 -->
      <div class="view settings-view" style="display: none">
        <div class="bg-white rounded-lg p-6 shadow-sm">
          <h2 class="text-2xl font-bold mb-6">设置</h2>

          <!-- 个性化设置 -->
          <div class="mb-8">
            <h3 class="text-lg font-semibold mb-4">个性化</h3>
            <div class="space-y-4">
              <!-- 主题色设置 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >主题色</label
                >
                <div class="flex gap-3">
                  <div
                    class="theme-option active"
                    style="background-color: #7c3aed"
                  ></div>
                  <div
                    class="theme-option"
                    style="background-color: #3b82f6"
                  ></div>
                  <div
                    class="theme-option"
                    style="background-color: #10b981"
                  ></div>
                  <div
                    class="theme-option"
                    style="background-color: #f59e0b"
                  ></div>
                </div>
              </div>

              <!-- 深色模式 -->
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">深色模式</div>
                  <div class="text-sm text-gray-500">降低亮度，保护眼睛</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="darkModeToggle" />
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <!-- 紧凑模式 -->
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">紧凑模式</div>
                  <div class="text-sm text-gray-500">减小内容间距</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- 通知设置 -->
          <div class="mb-8">
            <h3 class="text-lg font-semibold mb-4">通知设置</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">任务到期提醒</div>
                  <div class="text-sm text-gray-500">在任务到期前发送通知</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" checked />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium">每日任务总结</div>
                  <div class="text-sm text-gray-500">每天发送任务完成情况</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- 快捷键设置 -->
          <div class="mb-8">
            <h3 class="text-lg font-semibold mb-4">快捷键设置</h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center py-2">
                <span>新建任务</span>
                <span class="px-2 py-1 bg-gray-100 rounded text-sm"
                  >Ctrl + N</span
                >
              </div>
              <div class="flex justify-between items-center py-2">
                <span>开始专注</span>
                <span class="px-2 py-1 bg-gray-100 rounded text-sm"
                  >Ctrl + F</span
                >
              </div>
              <div class="flex justify-between items-center py-2">
                <span>切换视图</span>
                <span class="px-2 py-1 bg-gray-100 rounded text-sm"
                  >Ctrl + Tab</span
                >
              </div>
            </div>
          </div>

          <!-- 保存按钮 -->
          <div class="flex justify-end">
            <button class="btn btn-primary" id="saveSettings">
              <i class="fas fa-save mr-2"></i>保存设置
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 专注模式遮罩 -->
    <div class="focus-mode" id="focusMode">
      <i class="fas fa-moon text-6xl mb-4"></i>
      <h2 class="text-2xl font-bold mb-2">专注模式已开启</h2>
      <p class="text-white/80 mb-8">保持专注，暂时屏蔽所有通知</p>
      <button class="btn btn-primary" onclick="toggleFocusMode()">
        <i class="fas fa-times mr-2"></i>结束专注
      </button>
    </div>

    <!-- 添加日历事件模态框 -->
    <div class="modal" id="eventModal">
      <div class="modal-content" style="max-width: 500px">
        <div class="modal-header flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold">添加日历事件</h3>
          <button class="close-btn text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="eventForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >事件标题</label
            >
            <input
              type="text"
              id="eventTitle"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-color focus:border-transparent"
              placeholder="输入事件标题"
              required
            />
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >开始时间</label
              >
              <input
                type="datetime-local"
                id="eventStart"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-color focus:border-transparent"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >结束时间</label
              >
              <input
                type="datetime-local"
                id="eventEnd"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-color focus:border-transparent"
                required
              />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >事件颜色</label
            >
            <div class="flex gap-3">
              <div
                class="w-8 h-8 rounded-full bg-[#7C3AED] cursor-pointer border-2 border-white hover:border-gray-300 event-color"
                data-color="#7C3AED"
              ></div>
              <div
                class="w-8 h-8 rounded-full bg-[#3B82F6] cursor-pointer border-2 border-white hover:border-gray-300 event-color"
                data-color="#3B82F6"
              ></div>
              <div
                class="w-8 h-8 rounded-full bg-[#10B981] cursor-pointer border-2 border-white hover:border-gray-300 event-color"
                data-color="#10B981"
              ></div>
              <div
                class="w-8 h-8 rounded-full bg-[#F59E0B] cursor-pointer border-2 border-white hover:border-gray-300 event-color"
                data-color="#F59E0B"
              ></div>
              <div
                class="w-8 h-8 rounded-full bg-[#EF4444] cursor-pointer border-2 border-white hover:border-gray-300 event-color"
                data-color="#EF4444"
              ></div>
            </div>
            <input type="hidden" id="eventColor" value="#7C3AED" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >备注</label
            >
            <textarea
              id="eventDescription"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-color focus:border-transparent"
              rows="3"
              placeholder="添加事件备注（可选）"
            ></textarea>
          </div>

          <div class="flex justify-end gap-2 mt-6">
            <button
              type="button"
              class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 close-modal"
            >
              取消
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-primary-color text-white rounded-md hover:bg-primary-dark"
            >
              保存
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- 事件详情模态框 -->
    <div class="modal" id="eventDetailModal">
      <div class="modal-content" style="max-width: 500px">
        <div class="modal-header flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold" id="detailTitle">事件详情</h3>
          <button class="close-btn text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <div class="text-sm text-gray-500">开始时间</div>
            <div class="font-medium" id="detailStart"></div>
          </div>
          <div>
            <div class="text-sm text-gray-500">结束时间</div>
            <div class="font-medium" id="detailEnd"></div>
          </div>
          <div id="detailDescWrapper">
            <div class="text-sm text-gray-500">备注</div>
            <div class="font-medium" id="detailDescription"></div>
          </div>

          <div class="flex justify-end gap-2 mt-6">
            <button
              id="deleteEventBtn"
              class="px-4 py-2 border border-red-300 text-red-600 rounded-md bg-white hover:bg-red-50"
            >
              <i class="fas fa-trash-alt mr-1"></i>删除
            </button>
            <button
              id="editEventBtn"
              class="px-4 py-2 bg-primary-color text-white rounded-md hover:bg-primary-dark"
            >
              <i class="fas fa-edit mr-1"></i>编辑
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 图表实例（使用window对象以确保全局访问）
      window.trendsChart = null;
      window.distributionChart = null;
      window.tagsChart = null;

      // 初始化图表
      function initializeCharts() {
        console.log("Initializing charts...");

        // 销毁现有的图表实例
        if (window.trendsChart) {
          window.trendsChart.destroy();
          window.trendsChart = null;
        }
        if (window.distributionChart) {
          window.distributionChart.destroy();
          window.distributionChart = null;
        }
        if (window.tagsChart) {
          window.tagsChart.destroy();
          window.tagsChart = null;
        }

        // 任务趋势图
        const trendsCtx = document.getElementById("trendsChart");
        if (trendsCtx) {
          console.log("Found trends chart canvas");
          try {
            window.trendsChart = new Chart(trendsCtx, {
              type: "line",
              data: {
                labels: [
                  "周一",
                  "周二",
                  "周三",
                  "周四",
                  "周五",
                  "周六",
                  "周日",
                ],
                datasets: [
                  {
                    label: "完成任务数",
                    data: [3, 5, 2, 4, 6, 2, 4],
                    borderColor: "#7C3AED",
                    backgroundColor: "rgba(124, 58, 237, 0.1)",
                    tension: 0.4,
                    fill: true,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false,
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      stepSize: 1,
                    },
                  },
                },
              },
            });
            console.log("Trends chart initialized");
          } catch (error) {
            console.error("Error initializing trends chart:", error);
          }
        } else {
          console.error("Trends chart canvas not found");
        }

        // 任务分布图
        const distributionCtx = document.getElementById("distributionChart");
        if (distributionCtx) {
          console.log("Found distribution chart canvas");
          try {
            window.distributionChart = new Chart(distributionCtx, {
              type: "doughnut",
              data: {
                labels: ["待处理", "进行中", "已完成"],
                datasets: [
                  {
                    data: [8, 5, 11],
                    backgroundColor: ["#F59E0B", "#3B82F6", "#10B981"],
                    borderWidth: 0,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: "bottom",
                    labels: {
                      padding: 20,
                      usePointStyle: true,
                    },
                  },
                },
                cutout: "60%",
              },
            });
            console.log("Distribution chart initialized");
          } catch (error) {
            console.error("Error initializing distribution chart:", error);
          }
        } else {
          console.error("Distribution chart canvas not found");
        }

        // 标签统计图
        const tagsCtx = document.getElementById("tagsChart");
        if (tagsCtx) {
          console.log("Found tags chart canvas");
          try {
            window.tagsChart = new Chart(tagsCtx, {
              type: "bar",
              data: {
                labels: ["工作", "学习", "生活", "重要", "紧急", "个人"],
                datasets: [
                  {
                    label: "任务数量",
                    data: [12, 8, 5, 7, 4, 6],
                    backgroundColor: [
                      "#6366F1", // 工作 - 紫蓝色
                      "#60A5FA", // 学习 - 蓝色
                      "#34D399", // 生活 - 绿色
                      "#F87171", // 重要 - 红色
                      "#FBBF24", // 紧急 - 黄色
                      "#A78BFA", // 个人 - 紫色
                    ],
                    borderWidth: 0,
                    borderRadius: 4,
                    maxBarThickness: 40,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false,
                  },
                  tooltip: {
                    callbacks: {
                      label: function (context) {
                        let label = context.dataset.label || "";
                        if (label) {
                          label += ": ";
                        }
                        if (context.parsed.y !== null) {
                          label += context.parsed.y + " 个任务";
                        }
                        return label;
                      },
                    },
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      stepSize: 2,
                    },
                    title: {
                      display: true,
                      text: "任务数量",
                    },
                  },
                  x: {
                    title: {
                      display: true,
                      text: "标签类型",
                    },
                  },
                },
              },
            });
            console.log("Tags chart initialized");
          } catch (error) {
            console.error("Error initializing tags chart:", error);
          }
        } else {
          console.error("Tags chart canvas not found");
        }
      }

      // 初始化视图
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM Content Loaded");

        // 获取所有视图容器
        const views = {
          home: document.querySelector(".home-view"),
          dashboard: document.querySelector(".dashboard-view"),
          calendar: document.querySelector(".calendar-view"),
          settings: document.querySelector(".settings-view"),
        };

        console.log("Views:", views);

        // 默认显示首页，隐藏其他视图
        Object.values(views).forEach((view) => {
          if (view) {
            view.style.display = "none";
          }
        });
        if (views.home) {
          views.home.style.display = "block";
        }

        // 为侧边栏导航项添加点击事件
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.addEventListener("click", () => {
            console.log("Nav item clicked:", item.getAttribute("data-view"));

            // 更新导航项状态
            document.querySelectorAll(".nav-item").forEach((nav) => {
              nav.classList.remove("active");
            });
            item.classList.add("active");

            // 获取要显示的视图
            const viewName = item.getAttribute("data-view");
            console.log("Switching to view:", viewName);

            // 隐藏所有视图
            Object.values(views).forEach((view) => {
              if (view) {
                view.style.display = "none";
              }
            });

            // 显示选中的视图
            if (views[viewName]) {
              views[viewName].style.display = "block";

              // 如果是数据统计视图，初始化图表
              if (viewName === "dashboard") {
                console.log("Dashboard view active, initializing charts...");
                // 延迟初始化图表，确保DOM已经更新
                setTimeout(() => {
                  try {
                    initializeCharts();
                  } catch (error) {
                    console.error("Error initializing charts:", error);
                  }
                }, 500);
              }

              // 如果是日历视图，初始化或重新渲染日历
              if (viewName === "calendar") {
                console.log("日历视图被激活");
                setTimeout(() => {
                  try {
                    const calendarEl = document.getElementById("calendar");
                    if (!calendarEl) {
                      console.error("找不到日历容器元素");
                      return;
                    }

                    if (!window.calendar) {
                      console.log("初始化新的日历");
                      window.calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: "dayGridMonth",
                        locale: "zh-cn",
                        headerToolbar: {
                          left: "prev,next today",
                          center: "title",
                          right: "dayGridMonth,timeGridWeek,listWeek"
                        },
                        buttonText: {
                          today: "今天",
                          month: "月",
                          week: "周",
                          list: "列表"
                        },
                        height: "600px",
                        expandRows: true,
                        navLinks: true,
                        editable: true,
                        dayMaxEvents: true,
                        events: [
                          {
                            title: "项目会议",
                            start: "2024-03-20T10:00:00",
                            end: "2024-03-20T11:30:00"
                          }
                        ]
                      });
                    }

                    console.log("渲染日历");
                    window.calendar.render();
                  } catch (error) {
                    console.error("日历初始化/渲染失败:", error);
                  }
                }, 100);
              }
            }
          });
        });

        // 如果当前是数据统计视图，初始化图表
        const dashboardView = document.querySelector(".dashboard-view");
        if (dashboardView && dashboardView.style.display !== "none") {
          console.log("Dashboard view is active, initializing charts");
          setTimeout(() => {
            try {
              initializeCharts();
            } catch (error) {
              console.error("Error initializing charts:", error);
            }
          }, 500);
        }
      });

      // 模态框管理
      const addTaskBtn = document.getElementById("addTaskBtn");
      const addTodayTaskBtn = document.getElementById("addTodayTaskBtn");
      const taskModal = document.getElementById("taskModal");
      const closeButtons = document.querySelectorAll(
        ".close-btn, .close-modal"
      );

      addTaskBtn.addEventListener("click", () => {
        taskModal.classList.add("active");
      });

      // 今日待办页面的添加任务按钮
      if (addTodayTaskBtn) {
        addTodayTaskBtn.addEventListener("click", () => {
          taskModal.classList.add("active");
        });
      }

      closeButtons.forEach((button) => {
        button.addEventListener("click", () => {
          taskModal.classList.remove("active");
        });
      });

      // 点击模态框外部关闭
      taskModal.addEventListener("click", (e) => {
        if (e.target === taskModal) {
          taskModal.classList.remove("active");
        }
      });

      // ESC键关闭模态框
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && taskModal.classList.contains("active")) {
          taskModal.classList.remove("active");
        }
      });

      // 任务表单提交
      document.getElementById("taskForm").addEventListener("submit", (e) => {
        e.preventDefault();
        // 这里添加保存任务的逻辑
        taskModal.classList.remove("active");
      });

      // 任务卡片悬停效果
      document.querySelectorAll(".task-card").forEach((card) => {
        card.addEventListener("mouseenter", () => {
          card.classList.add("animate__animated", "animate__pulse");
        });

        card.addEventListener("mouseleave", () => {
          card.classList.remove("animate__animated", "animate__pulse");
        });
      });

      // 今日待办直接点击处理
      const todayTaskLink = document.querySelector(
        '.nav-item[data-filter="today"]'
      );
      if (todayTaskLink) {
        todayTaskLink.addEventListener("click", function () {
          console.log("今日待办被点击");

          // 方案一：创建并显示新的今日待办内容
          // 获取主内容区域
          const mainContentArea = document.querySelector(".main-content");
          if (!mainContentArea) {
            console.error("找不到主内容区域");
            return;
          }

          // 隐藏所有视图
          document.querySelectorAll(".view").forEach((view) => {
            view.style.display = "none";
          });

          // 创建今日待办内容
          mainContentArea.innerHTML = `
            <div class="section-header">
              <h2 class="text-2xl font-bold mb-6">今日待办</h2>
              <div class="view-actions">
                <select class="sort-select">
                  <option value="priority">按优先级</option>
                  <option value="deadline">按截止时间</option>
                  <option value="created">按创建时间</option>
                </select>
                <button class="btn btn-primary" id="addTodayTaskBtn">
                  <i class="fas fa-plus mr-2"></i>添加任务
                </button>
              </div>
            </div>

            <!-- 今日待办统计 -->
            <div class="today-stats">
              <div class="stat-item">
                <div class="stat-value">7</div>
                <div class="stat-label">总任务</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">3</div>
                <div class="stat-label">已完成</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">4</div>
                <div class="stat-label">剩余</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">42.8%</div>
                <div class="stat-label">完成率</div>
              </div>
            </div>

            <!-- 今日任务列表 -->
            <div class="today-tasks">
              <!-- 高优先级任务 -->
              <div class="task-group">
                <div class="task-group-header">
                  <h3 class="task-group-title">
                    <i class="fas fa-circle text-red-500 mr-2"></i>高优先级
                  </h3>
                  <span class="task-count">2</span>
                </div>
                <div class="task-list">
                  <div class="task-item">
                    <div class="task-checkbox">
                      <input type="checkbox" id="today-task1">
                      <label for="today-task1"></label>
                    </div>
                    <div class="task-content">
                      <h4 class="task-title">首页重构</h4>
                      <div class="task-meta">
                        <span class="deadline"
                          ><i class="far fa-clock mr-1"></i>剩余2天</span
                        >
                        <span class="progress">完成度75%</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%"></div>
                      </div>
                    </div>
                    <div class="task-actions">
                      <button class="task-action-btn">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                  <div class="task-item">
                    <div class="task-checkbox">
                      <input type="checkbox" id="today-task2">
                      <label for="today-task2"></label>
                    </div>
                    <div class="task-content">
                      <h4 class="task-title">API开发</h4>
                      <div class="task-meta">
                        <span class="deadline"
                          ><i class="far fa-clock mr-1"></i>剩余3天</span
                        >
                        <span class="progress">完成度60%</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%"></div>
                      </div>
                    </div>
                    <div class="task-actions">
                      <button class="task-action-btn">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 中优先级任务 -->
              <div class="task-group">
                <div class="task-group-header">
                  <h3 class="task-group-title">
                    <i class="fas fa-circle text-yellow-500 mr-2"></i>中优先级
                  </h3>
                  <span class="task-count">2</span>
                </div>
                <div class="task-list">
                  <div class="task-item">
                    <div class="task-checkbox">
                      <input type="checkbox" id="today-task3">
                      <label for="today-task3"></label>
                    </div>
                    <div class="task-content">
                      <h4 class="task-title">团队周会</h4>
                      <div class="task-meta">
                        <span class="deadline"
                          ><i class="far fa-clock mr-1"></i>今天 10:00</span
                        >
                      </div>
                    </div>
                    <div class="task-actions">
                      <button class="task-action-btn">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                  <div class="task-item">
                    <div class="task-checkbox">
                      <input type="checkbox" id="today-task4">
                      <label for="today-task4"></label>
                    </div>
                    <div class="task-content">
                      <h4 class="task-title">数据分析</h4>
                      <div class="task-meta">
                        <span class="deadline"
                          ><i class="far fa-clock mr-1"></i>今天 16:00</span
                        >
                        <span class="progress">完成度40%</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill" style="width: 40%"></div>
                      </div>
                    </div>
                    <div class="task-actions">
                      <button class="task-action-btn">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 已完成任务 -->
              <div class="task-group completed-group">
                <div class="task-group-header">
                  <h3 class="task-group-title">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>已完成
                  </h3>
                  <span class="task-count">3</span>
                </div>
                <div class="task-list">
                  <div class="task-item completed">
                    <div class="task-checkbox">
                      <input type="checkbox" id="today-task5" checked />
                      <label for="today-task5"></label>
                    </div>
                    <div class="task-content">
                      <h4 class="task-title">登录功能优化</h4>
                      <div class="task-meta">
                        <span class="completion-time"
                          ><i class="far fa-check-circle mr-1"></i>今天
                          09:30</span
                        >
                      </div>
                    </div>
                    <div class="task-actions">
                      <button class="task-action-btn">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                  <div class="task-item completed">
                    <div class="task-checkbox">
                      <input type="checkbox" id="today-task6" checked />
                      <label for="today-task6"></label>
                    </div>
                    <div class="task-content">
                      <h4 class="task-title">Bug修复</h4>
                      <div class="task-meta">
                        <span class="completion-time"
                          ><i class="far fa-check-circle mr-1"></i>今天
                          11:20</span
                        >
                      </div>
                    </div>
                    <div class="task-actions">
                      <button class="task-action-btn">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                  <div class="task-item completed">
                    <div class="task-checkbox">
                      <input type="checkbox" id="today-task7" checked />
                      <label for="today-task7"></label>
                    </div>
                    <div class="task-content">
                      <h4 class="task-title">文档更新</h4>
                      <div class="task-meta">
                        <span class="completion-time"
                          ><i class="far fa-check-circle mr-1"></i>今天
                          13:45</span
                        >
                      </div>
                    </div>
                    <div class="task-actions">
                      <button class="task-action-btn">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;

          console.log("今日待办内容已动态创建");

          // 更新标题
          const pageTitle = document.querySelector(".main-header h1");
          if (pageTitle) {
            pageTitle.textContent = "今日待办";
          }

          // 更新侧边栏状态
          document.querySelectorAll(".nav-item").forEach((item) => {
            item.classList.remove("active");
          });
          this.classList.add("active");

          // 绑定添加任务按钮事件
          const addTodayTaskBtn = document.getElementById("addTodayTaskBtn");
          if (addTodayTaskBtn) {
            addTodayTaskBtn.addEventListener("click", () => {
              const taskModal = document.getElementById("taskModal");
              if (taskModal) {
                taskModal.classList.add("active");
              }
            });
          }
        });
      }

      // 初始化日历视图按钮事件
      document.querySelectorAll(".calendar-view-btn").forEach((button) => {
        button.addEventListener("click", () => {
          const view = button.getAttribute("data-view");
          if (window.calendar) {
            window.calendar.changeView(view);
          }

          // 更新按钮状态
          document.querySelectorAll(".calendar-view-btn").forEach((btn) => {
            btn.classList.remove("active");
          });
          button.classList.add("active");
        });
      });

      // 添加事件按钮
      const addEventBtn = document.getElementById("addEventBtn");
      if (addEventBtn) {
        addEventBtn.addEventListener("click", () => {
          const title = prompt("请输入事件标题:");
          if (title && window.calendar) {
            const date = new Date();
            window.calendar.addEvent({
              title: title,
              start: date,
              allDay: true,
              backgroundColor: "#7C3AED",
              borderColor: "#7C3AED",
            });
          }
        });
      }

      // 删除事件
      window.deleteEvent = function (eventId) {
        if (window.calendar) {
          const event = window.calendar.getEventById(eventId);
          if (event && confirm("确定要删除这个事件吗？")) {
            event.remove();
            closeEventDetails();
          }
        }
      };

      // 关闭事件详情
      window.closeEventDetails = function () {
        const modal = document.getElementById("eventDetailsModal");
        if (modal) {
          modal.classList.add("animate__fadeOutDown");
          setTimeout(() => {
            modal.remove();
          }, 300);
        }
      };

      // 主题切换
      document.querySelectorAll(".theme-option").forEach((option) => {
        option.addEventListener("click", () => {
          const color = option.style.backgroundColor;
          document.documentElement.style.setProperty("--primary-color", color);
          document.querySelectorAll(".theme-option").forEach((opt) => {
            opt.classList.remove("active");
          });
          option.classList.add("active");
        });
      });

      // 标签统计图表的时间筛选
      document.addEventListener("DOMContentLoaded", function () {
        // 为标签统计图的筛选按钮添加点击事件
        document
          .querySelectorAll(".chart-box .chart-filter-btn")
          .forEach((btn) => {
            btn.addEventListener("click", function () {
              const parent = this.closest(".chart-box");
              if (!parent) return;

              // 更新按钮状态
              parent.querySelectorAll(".chart-filter-btn").forEach((b) => {
                b.classList.remove("active");
              });
              this.classList.add("active");

              const period = this.getAttribute("data-period");
              const chartId = parent.querySelector("canvas")?.id;

              if (chartId === "tagsChart") {
                console.log("Filtering tags chart by period:", period);

                // 根据时间段更新标签数据
                let data;
                if (period === "week") {
                  data = [8, 5, 3, 4, 2, 3]; // 本周数据
                } else if (period === "month") {
                  data = [10, 7, 4, 6, 3, 5]; // 本月数据
                } else {
                  data = [12, 8, 5, 7, 4, 6]; // 全部数据
                }

                // 更新图表数据
                if (window.tagsChart) {
                  window.tagsChart.data.datasets[0].data = data;
                  window.tagsChart.update();
                }
              }
            });
          });
      });

      // 深色模式切换
      const darkModeToggle = document.getElementById("darkModeToggle");
      if (darkModeToggle) {
        darkModeToggle.addEventListener("change", () => {
          document.body.classList.toggle("dark-mode");
        });
      }

      // 保存设置
      const saveSettingsBtn = document.getElementById("saveSettings");
      if (saveSettingsBtn) {
        saveSettingsBtn.addEventListener("click", () => {
          alert("设置已保存");
        });
      }

      // 初始化图表
      document.addEventListener("DOMContentLoaded", function () {
        let trendsChart = null;
        let distributionChart = null;

        function initializeCharts() {
          console.log("Initializing charts...");

          // 销毁现有的图表实例
          if (trendsChart) {
            trendsChart.destroy();
          }
          if (distributionChart) {
            distributionChart.destroy();
          }

          // 任务趋势图
          const trendsCtx = document.getElementById("trendsChart");
          if (trendsCtx) {
            console.log("Found trends chart canvas");
            trendsChart = new Chart(trendsCtx, {
              type: "line",
              data: {
                labels: [
                  "周一",
                  "周二",
                  "周三",
                  "周四",
                  "周五",
                  "周六",
                  "周日",
                ],
                datasets: [
                  {
                    label: "已完成",
                    data: [12, 19, 15, 20, 18, 15, 14],
                    borderColor: "#7C3AED",
                    backgroundColor: "rgba(124, 58, 237, 0.1)",
                    tension: 0.4,
                    fill: true,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false,
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      stepSize: 1,
                    },
                  },
                },
              },
            });
          } else {
            console.error("Trends chart canvas not found");
          }

          // 任务分布图
          const distributionCtx = document.getElementById("distributionChart");
          if (distributionCtx) {
            console.log("Found distribution chart canvas");
            distributionChart = new Chart(distributionCtx, {
              type: "doughnut",
              data: {
                labels: ["待处理", "进行中", "已完成"],
                datasets: [
                  {
                    data: [8, 5, 11],
                    backgroundColor: ["#F59E0B", "#3B82F6", "#10B981"],
                    borderWidth: 0,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: "bottom",
                    labels: {
                      padding: 20,
                      usePointStyle: true,
                    },
                  },
                },
                cutout: "60%",
              },
            });
          } else {
            console.error("Distribution chart canvas not found");
          }
        }

        // 确保在视图切换时重新初始化图表
        const dashboardNav = document.querySelector(
          '.nav-item[data-view="dashboard"]'
        );
        if (dashboardNav) {
          dashboardNav.addEventListener("click", () => {
            console.log("Dashboard view clicked");
            // 延迟初始化以确保视图已切换
            setTimeout(() => {
              console.log("Delayed chart initialization");
              initializeCharts();
            }, 300);
          });
        }

        // 如果当前是数据统计视图，立即初始化图表
        if (
          document.querySelector(".dashboard-container").style.display !==
          "none"
        ) {
          console.log("Dashboard view is active, initializing charts");
          initializeCharts();
        }

        // 日历初始化函数
        function initializeCalendar() {
          console.log("开始初始化日历...");
          const calendarEl = document.getElementById("calendar");

          if (!calendarEl) {
            console.error("找不到日历容器元素");
            return;
          }

          // 示例事件数据
          const sampleEvents = [
            {
              id: "1",
              title: "项目启动会议",
              start: "2024-03-20T10:00:00",
              end: "2024-03-20T11:30:00",
              backgroundColor: "#7C3AED",
              borderColor: "#7C3AED",
              description: "讨论新项目的目标和计划",
            },
            {
              id: "2",
              title: "代码评审",
              start: "2024-03-21T14:00:00",
              end: "2024-03-21T15:00:00",
              backgroundColor: "#3B82F6",
              borderColor: "#3B82F6",
              description: "评审前端新功能的代码",
            },
            {
              id: "3",
              title: "团队周会",
              start: "2024-03-22T09:30:00",
              end: "2024-03-22T10:30:00",
              backgroundColor: "#10B981",
              borderColor: "#10B981",
              description: "讨论本周进度和下周计划",
            },
          ];

          try {
            // 初始化日历
            window.calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: "dayGridMonth",
            locale: "zh-cn",
            headerToolbar: {
              left: "prev,next today",
              center: "title",
              right: "dayGridMonth,timeGridWeek,listWeek",
            },
            buttonText: {
              today: "今天",
              month: "月",
              week: "周",
              list: "列表",
            },
            height: "600px",
            expandRows: true,
            navLinks: true,
            editable: true,
            dayMaxEvents: true,
            events: sampleEvents,
            eventClick: function (info) {
              // 显示事件详情模态框
              const eventDetailModal =
                document.getElementById("eventDetailModal");
              if (!eventDetailModal) {
                console.error("找不到事件详情模态框");
                return;
              }

              // 设置模态框数据
              eventDetailModal.dataset.eventId = info.event.id;
              document.getElementById("detailTitle").textContent =
                info.event.title;

              // 格式化日期显示
              const startDate = info.event.start;
              const endDate = info.event.end || startDate;
              const formatOptions = {
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
              };

              document.getElementById("detailStart").textContent =
                startDate.toLocaleString("zh-CN", formatOptions);
              document.getElementById("detailEnd").textContent =
                endDate.toLocaleString("zh-CN", formatOptions);

              // 设置描述信息
              const description = info.event.extendedProps.description || "";
              const descWrapper = document.getElementById("detailDescWrapper");
              const descElement = document.getElementById("detailDescription");

              if (description) {
                descWrapper.style.display = "block";
                descElement.textContent = description;
              } else {
                descWrapper.style.display = "none";
              }

              // 显示模态框
              eventDetailModal.classList.add("active");
            },
            dateClick: function (info) {
              // 点击日期时打开添加事件模态框
              const eventModal = document.getElementById("eventModal");
              const eventStart = document.getElementById("eventStart");
              const eventEnd = document.getElementById("eventEnd");

              // 设置默认时间为点击日期的9:00-10:00
              const startDate = new Date(info.date);
              startDate.setHours(9, 0, 0);
              const endDate = new Date(startDate);
              endDate.setHours(10, 0, 0);

              eventStart.value = formatDateForInput(startDate);
              eventEnd.value = formatDateForInput(endDate);

              // 显示模态框
              eventModal.classList.add("active");
            },
          });

          window.calendar.render();
          console.log("日历初始化完成");
        }

        // 日期格式化辅助函数 (转为 YYYY-MM-DDThh:mm 格式)
        function formatDateForInput(date) {
          return (
            date.getFullYear() +
            "-" +
            String(date.getMonth() + 1).padStart(2, "0") +
            "-" +
            String(date.getDate()).padStart(2, "0") +
            "T" +
            String(date.getHours()).padStart(2, "0") +
            ":" +
            String(date.getMinutes()).padStart(2, "0")
          );
        }

        // 初始化日历
        const calendarEl = document.getElementById("calendar");
        if (calendarEl) {
          initializeCalendar();
        }
      });

      // 切换专注模式
      function toggleFocusMode() {
        const focusMode = document.getElementById("focusMode");
        focusMode.classList.toggle("active");
        if (focusMode.classList.contains("active")) {
          document.body.style.overflow = "hidden";
        } else {
          document.body.style.overflow = "";
        }
      }

      // 番茄钟功能
      let pomodoroTimer = null;
      let pomodoroTime = 25 * 60;
      let isRunning = false;

      document
        .getElementById("startPomodoro")
        .addEventListener("click", startPomodoro);
      document
        .getElementById("pausePomodoro")
        .addEventListener("click", pausePomodoro);

      function startPomodoro() {
        if (!isRunning) {
          isRunning = true;
          pomodoroTimer = setInterval(() => {
            pomodoroTime--;
            updatePomodoroDisplay();
            if (pomodoroTime <= 0) {
              clearInterval(pomodoroTimer);
              isRunning = false;
              alert("番茄时间结束！");
              pomodoroTime = 25 * 60;
              updatePomodoroDisplay();
            }
          }, 1000);
        }
      }

      function pausePomodoro() {
        if (isRunning) {
          clearInterval(pomodoroTimer);
          isRunning = false;
        }
      }

      function updatePomodoroDisplay() {
        const minutes = Math.floor(pomodoroTime / 60);
        const seconds = pomodoroTime % 60;
        document.getElementById("pomodoroTimer").textContent = `${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
      }

      // 子任务系统
      const subtaskCheckboxes = document.querySelectorAll(".subtask-checkbox");
      subtaskCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", () => {
          const subtaskText = checkbox.nextElementSibling;
          if (checkbox.checked) {
            subtaskText.classList.add("line-through", "text-gray-500");
          } else {
            subtaskText.classList.remove("line-through", "text-gray-500");
          }
          updateSubtaskProgress();
        });
      });

      function updateSubtaskProgress() {
        const total = subtaskCheckboxes.length;
        const completed = document.querySelectorAll(
          ".subtask-checkbox:checked"
        ).length;
        document.querySelector(
          ".text-sm.text-gray-500"
        ).textContent = `${completed}/${total} 已完成`;
      }

      // 同步功能模拟
      function simulateSync() {
        const syncStatus = document.querySelector(".sync-status");
        const icon = syncStatus.querySelector("i");
        icon.classList.add("fa-spin");
        setTimeout(() => {
          icon.classList.remove("fa-spin");
          const now = new Date();
          const timeString = now.toLocaleString("zh-CN", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
          });
          syncStatus.querySelector(
            "span"
          ).textContent = `上次同步时间：${timeString}`;
        }, 2000);
      }

      // 绑定事件监听器
      document.addEventListener("DOMContentLoaded", () => {
        // 番茄钟按钮
        document
          .querySelector(".btn-primary")
          .addEventListener("click", startPomodoro);
        document
          .querySelector(".btn-secondary")
          .addEventListener("click", pausePomodoro);

        // 同步按钮
        document
          .querySelector(".sync-status")
          .addEventListener("click", simulateSync);

        // 初始化显示
        updatePomodoroDisplay();
        updateSubtaskProgress();
      });

      // 任务拖拽功能
      function initDragAndDrop() {
        const taskCards = document.querySelectorAll(".task-card");
        const dropZones = document.querySelectorAll(".task-list");

        taskCards.forEach((card) => {
          card.setAttribute("draggable", true);
          card.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("text/plain", card.id);
            card.classList.add("opacity-50");
          });

          card.addEventListener("dragend", () => {
            card.classList.remove("opacity-50");
          });
        });

        dropZones.forEach((zone) => {
          zone.addEventListener("dragover", (e) => {
            e.preventDefault();
            zone.classList.add("bg-primary-bg");
          });

          zone.addEventListener("dragleave", () => {
            zone.classList.remove("bg-primary-bg");
          });

          zone.addEventListener("drop", (e) => {
            e.preventDefault();
            zone.classList.remove("bg-primary-bg");
            const cardId = e.dataTransfer.getData("text/plain");
            const card = document.getElementById(cardId);
            zone.appendChild(card);
            // 更新任务状态
            updateTaskStatus(cardId, zone.getAttribute("data-status"));
          });
        });
      }

      // 任务右键菜单
      document.addEventListener("click", (e) => {
        const taskMenu = document.getElementById("taskMenu");
        if (
          !e.target.closest(".task-card") &&
          !e.target.closest(".task-menu")
        ) {
          taskMenu.classList.add("hidden");
        }
      });

      function showTaskMenu(e, taskId) {
        e.preventDefault();
        const taskMenu = document.getElementById("taskMenu");
        taskMenu.style.top = `${e.pageY}px`;
        taskMenu.style.left = `${e.pageX}px`;
        taskMenu.classList.remove("hidden");
        taskMenu.setAttribute("data-task-id", taskId);
      }

      // 新建任务
      function openNewTaskModal() {
        document.getElementById("newTaskModal").classList.add("active");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
      }

      function addSubtask() {
        const subtaskList = document.getElementById("subtaskList");
        const subtaskItem = document.createElement("div");
        subtaskItem.className = "flex items-center gap-2";
        subtaskItem.innerHTML = `
          <input type="text" class="form-input flex-1" placeholder="请输入子任务">
          <button type="button" class="text-red-500 hover:text-red-700" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        `;
        subtaskList.appendChild(subtaskItem);
      }

      function saveTask() {
        // 这里添加保存任务的逻辑
        closeModal("newTaskModal");
        // 刷新任务列表
        // 显示成功提示
      }

      // 初始化
      document.addEventListener("DOMContentLoaded", () => {
        initDragAndDrop();
        updatePomodoroDisplay();
      });

      // 任务完成状态切换
      function toggleTaskComplete(checkbox) {
        const taskCard = checkbox.closest(".task-card");
        if (checkbox.checked) {
          taskCard.classList.add("completed");
          // 添加过渡动画
          setTimeout(() => {
            // 移动到已完成列表
            const completedList = document.querySelector(".completed-list");
            if (completedList) {
              completedList.appendChild(taskCard);
            }
          }, 300);
        } else {
          taskCard.classList.remove("completed");
          // 如果需要，可以将任务移回原列表
        }

        // 更新任务状态
        updateTaskStatus(taskCard.dataset.taskId, checkbox.checked);
      }

      // 更新任务状态
      function updateTaskStatus(taskId, isCompleted) {
        // 这里添加与后端通信的代码
        console.log(
          `任务 ${taskId} 状态更新为: ${isCompleted ? "已完成" : "未完成"}`
        );
      }

      // 视图切换逻辑
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM Content Loaded - Starting initialization...");

        // 获取所有视图容器
        const views = {
          home: document.querySelector(".home-view"),
          dashboard: document.querySelector(".dashboard-view"),
          calendar: document.querySelector(".calendar-view"),
          settings: document.querySelector(".settings-view"),
        };

        console.log("Views found:", views);

        // 默认显示首页，隐藏其他视图
        Object.values(views).forEach((view) => {
          if (view) {
            view.style.display = "none";
          }
        });
        if (views.home) {
          views.home.style.display = "block";
        }

        // 为侧边栏导航项添加点击事件
        document.querySelectorAll(".nav-item[data-view]").forEach((item) => {
          item.addEventListener("click", () => {
            const viewName = item.getAttribute("data-view");
            console.log("Nav item clicked:", viewName);

            // 更新导航项状态
            document.querySelectorAll(".nav-item").forEach((nav) => {
              nav.classList.remove("active");
            });
            item.classList.add("active");

            // 隐藏所有视图
            Object.values(views).forEach((view) => {
              if (view) {
                view.style.display = "none";
              }
            });

            // 显示选中的视图
            if (views[viewName]) {
              views[viewName].style.display = "block";

              // 如果是数据统计视图，初始化图表
              if (viewName === "dashboard") {
                console.log("Dashboard view active, initializing charts...");
                setTimeout(() => {
                  try {
                    initializeCharts();
                  } catch (error) {
                    console.error("Error initializing charts:", error);
                  }
                }, 100);
              }

              // 如果是日历视图，初始化或重新渲染日历
              if (viewName === "calendar") {
                console.log("Calendar view active");
                setTimeout(() => {
                  try {
                    if (window.calendar) {
                      console.log("Re-rendering existing calendar");
                      window.calendar.render();
                    } else {
                      console.log("Initializing new calendar");
                      initializeCalendar();
                    }
                  } catch (error) {
                    console.error("Error initializing calendar:", error);
                  }
                }, 100);
              }
            }
          });
        });

        // 初始化日历
        function initializeCalendar() {
          console.log("开始初始化日历...");
          const calendarEl = document.getElementById("calendar");

          if (!calendarEl) {
            console.error("找不到日历容器元素");
            return;
          }

          // 示例事件数据
          const sampleEvents = [
            {
              id: "1",
              title: "项目启动会议",
              start: "2024-03-20T10:00:00",
              end: "2024-03-20T11:30:00",
              backgroundColor: "#7C3AED",
              borderColor: "#7C3AED",
              description: "讨论新项目的目标和计划",
            },
            {
              id: "2",
              title: "代码评审",
              start: "2024-03-21T14:00:00",
              end: "2024-03-21T15:00:00",
              backgroundColor: "#3B82F6",
              borderColor: "#3B82F6",
              description: "评审前端新功能的代码",
            },
            {
              id: "3",
              title: "团队周会",
              start: "2024-03-22T09:30:00",
              end: "2024-03-22T10:30:00",
              backgroundColor: "#10B981",
              borderColor: "#10B981",
              description: "讨论本周进度和下周计划",
            },
          ];

          try {
            // 初始化日历
            window.calendar = new FullCalendar.Calendar(calendarEl, {
              initialView: "dayGridMonth",
              locale: "zh-cn",
              headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth,timeGridWeek,listWeek",
              },
              buttonText: {
                today: "今天",
                month: "月",
                week: "周",
                list: "列表",
              },
              height: "600px",
              expandRows: true,
              navLinks: true,
              editable: true,
              dayMaxEvents: true,
              events: sampleEvents,
              eventClick: function (info) {
                // 显示事件详情模态框
                const eventDetailModal =
                  document.getElementById("eventDetailModal");
                if (!eventDetailModal) {
                  console.error("找不到事件详情模态框");
                  return;
                }

                // 设置模态框数据
                eventDetailModal.dataset.eventId = info.event.id;
                document.getElementById("detailTitle").textContent =
                  info.event.title;

                // 格式化日期显示
                const startDate = info.event.start;
                const endDate = info.event.end || startDate;
                const formatOptions = {
                  year: "numeric",
                  month: "2-digit",
                  day: "2-digit",
                  hour: "2-digit",
                  minute: "2-digit",
                };

                document.getElementById("detailStart").textContent =
                  startDate.toLocaleString("zh-CN", formatOptions);
                document.getElementById("detailEnd").textContent =
                  endDate.toLocaleString("zh-CN", formatOptions);

                // 设置描述信息
                const description = info.event.extendedProps.description || "";
                const descWrapper =
                  document.getElementById("detailDescWrapper");
                const descElement =
                  document.getElementById("detailDescription");

                if (description) {
                  descWrapper.style.display = "block";
                  descElement.textContent = description;
                } else {
                  descWrapper.style.display = "none";
                }

                // 显示模态框
                eventDetailModal.classList.add("active");
              },
              dateClick: function (info) {
                // 点击日期时打开添加事件模态框
                const eventModal = document.getElementById("eventModal");
                const eventStart = document.getElementById("eventStart");
                const eventEnd = document.getElementById("eventEnd");

                // 设置默认时间为点击日期的9:00-10:00
                const startDate = new Date(info.date);
                startDate.setHours(9, 0, 0);
                const endDate = new Date(startDate);
                endDate.setHours(10, 0, 0);

                eventStart.value = formatDateForInput(startDate);
                eventEnd.value = formatDateForInput(endDate);

                // 显示模态框
                eventModal.classList.add("active");
              },
            });

            window.calendar.render();
            console.log("日历初始化完成");
          } catch (error) {
            console.error("日历初始化失败:", error);
          }
        }

        // 日期格式化辅助函数 (转为 YYYY-MM-DDThh:mm 格式)
        function formatDateForInput(date) {
          return (
            date.getFullYear() +
            "-" +
            String(date.getMonth() + 1).padStart(2, "0") +
            "-" +
            String(date.getDate()).padStart(2, "0") +
            "T" +
            String(date.getHours()).padStart(2, "0") +
            ":" +
            String(date.getMinutes()).padStart(2, "0")
          );
        }

        // 初始化图表
        function initializeCharts() {
          // ... 图表初始化代码 ...
        }
      });

      // 日历事件模态框管理
      document.addEventListener("DOMContentLoaded", function () {
        // 获取模态框元素
        const eventModal = document.getElementById("eventModal");
        const eventDetailModal = document.getElementById("eventDetailModal");
        const addEventBtn = document.getElementById("addEventBtn");

        if (addEventBtn) {
          addEventBtn.addEventListener("click", function () {
            // 清空表单
            document.getElementById("eventForm").reset();

            // 设置默认颜色
            document.getElementById("eventColor").value = "#7C3AED";
            document.querySelectorAll(".event-color").forEach((color) => {
              color.classList.remove("border-primary-color");
            });
            document
              .querySelector('.event-color[data-color="#7C3AED"]')
              .classList.add("border-primary-color");

            // 设置默认时间（当天9点到10点）
            const now = new Date();
            now.setHours(9, 0, 0);
            const later = new Date(now);
            later.setHours(10, 0, 0);

            document.getElementById("eventStart").value =
              formatDateForInput(now);
            document.getElementById("eventEnd").value =
              formatDateForInput(later);

            // 显示模态框
            eventModal.classList.add("active");
          });
        }

        // 事件颜色选择
        document.querySelectorAll(".event-color").forEach((color) => {
          color.addEventListener("click", function () {
            // 移除其他颜色的选中状态
            document.querySelectorAll(".event-color").forEach((c) => {
              c.classList.remove("border-primary-color");
              c.classList.add("border-white");
            });

            // 添加当前颜色的选中状态
            this.classList.remove("border-white");
            this.classList.add("border-primary-color");

            // 更新隐藏输入
            document.getElementById("eventColor").value =
              this.getAttribute("data-color");
          });
        });

        // 事件表单提交
        const eventForm = document.getElementById("eventForm");
        if (eventForm) {
          eventForm.addEventListener("submit", function (e) {
            e.preventDefault();

            // 获取表单值
            const title = document.getElementById("eventTitle").value;
            const start = document.getElementById("eventStart").value;
            const end = document.getElementById("eventEnd").value;
            const color = document.getElementById("eventColor").value;
            const description =
              document.getElementById("eventDescription").value;

            // 创建新事件对象
            const newEvent = {
              id: "event-" + Date.now(), // 生成唯一ID
              title: title,
              start: new Date(start),
              end: new Date(end),
              backgroundColor: color,
              borderColor: color,
              description: description,
            };

            // 添加到日历
            if (window.calendar) {
              window.calendar.addEvent(newEvent);
            }

            // 关闭模态框
            eventModal.classList.remove("active");
          });
        }

        // 删除事件按钮
        const deleteEventBtn = document.getElementById("deleteEventBtn");
        if (deleteEventBtn) {
          deleteEventBtn.addEventListener("click", function () {
            const eventId = eventDetailModal.dataset.eventId;

            if (eventId && window.calendar) {
              // 查找并删除事件
              const event = window.calendar.getEventById(eventId);
              if (event) {
                event.remove();
              }

              // 关闭模态框
              eventDetailModal.classList.remove("active");
            }
          });
        }

        // 编辑事件按钮
        const editEventBtn = document.getElementById("editEventBtn");
        if (editEventBtn) {
          editEventBtn.addEventListener("click", function () {
            const eventId = eventDetailModal.dataset.eventId;

            if (eventId && window.calendar) {
              // 查找事件
              const event = window.calendar.getEventById(eventId);
              if (event) {
                // 关闭详情模态框
                eventDetailModal.classList.remove("active");

                // 填充编辑表单
                document.getElementById("eventTitle").value = event.title;
                document.getElementById("eventStart").value =
                  formatDateForInput(event.start);
                document.getElementById("eventEnd").value = formatDateForInput(
                  event.end || event.start
                );
                document.getElementById("eventColor").value =
                  event.backgroundColor;
                document.getElementById("eventDescription").value =
                  event.extendedProps.description || "";

                // 更新颜色选择UI
                document.querySelectorAll(".event-color").forEach((color) => {
                  color.classList.remove("border-primary-color");
                  color.classList.add("border-white");

                  if (
                    color.getAttribute("data-color") === event.backgroundColor
                  ) {
                    color.classList.remove("border-white");
                    color.classList.add("border-primary-color");
                  }
                });

                // 修改表单提交行为以更新事件
                const eventForm = document.getElementById("eventForm");
                const originalSubmitHandler = eventForm.onsubmit;

                eventForm.onsubmit = function (e) {
                  e.preventDefault();

                  // 获取新值
                  const title = document.getElementById("eventTitle").value;
                  const start = document.getElementById("eventStart").value;
                  const end = document.getElementById("eventEnd").value;
                  const color = document.getElementById("eventColor").value;
                  const description =
                    document.getElementById("eventDescription").value;

                  // 更新事件
                  event.setProp("title", title);
                  event.setStart(new Date(start));
                  event.setEnd(new Date(end));
                  event.setProp("backgroundColor", color);
                  event.setProp("borderColor", color);
                  event.setExtendedProp("description", description);

                  // 关闭模态框
                  eventModal.classList.remove("active");

                  // 还原提交处理程序
                  eventForm.onsubmit = originalSubmitHandler;
                };

                // 显示编辑模态框
                eventModal.classList.add("active");
              }
            }
          });
        }

        // 将模态框关闭按钮添加到日历事件模态框
        document
          .querySelectorAll(".close-btn, .close-modal")
          .forEach((button) => {
            button.addEventListener("click", function () {
              if (eventModal && eventModal.classList.contains("active")) {
                eventModal.classList.remove("active");
              }
              if (
                eventDetailModal &&
                eventDetailModal.classList.contains("active")
              ) {
                eventDetailModal.classList.remove("active");
              }
            });
          });

        // 点击模态框外部关闭
        [eventModal, eventDetailModal].forEach((modal) => {
          if (modal) {
            modal.addEventListener("click", function (e) {
              if (e.target === this) {
                this.classList.remove("active");
              }
            });
          }
        });

        // ESC键关闭模态框
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            if (eventModal && eventModal.classList.contains("active")) {
              eventModal.classList.remove("active");
            }
            if (
              eventDetailModal &&
              eventDetailModal.classList.contains("active")
            ) {
              eventDetailModal.classList.remove("active");
            }
          }
        });
      });

      // 任务卡片悬停效果
    </script>
  </body>
</html>
